(function(debug){var _initialized=false;var _transaction={id: "$transaction__id",transactions: $transactions,afterInit: "$command",timeout: $transaction__ttl,server:{location: "$homeDomain",basiin: "$basiinPath",file: "$filePath",tell: "$transaction__defaultPath"},maxTransfers: "$transaction__maxTransfers",maxElements: "$transaction__maxElements"};for(var i=0;i<_transaction.transactions.length;i++){if(window.hasOwnProperty(_transaction.transactions[i])&&_transaction.transactions[i]!=_transaction.id){alert("Basin session is running, hold on");return{init:function(){return null}}}}var _hash=function(a){var b=function(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128){b+=String.fromCharCode(d)}else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b};var c=function(a){var b="";var c;var d;for(c=7;c>=0;c--){d=a>>>c*4&15;b+=d.toString(16)}return b};var d=function(a){var b="";var c;var d;var e;for(c=0;c<=6;c+=2){d=a>>>c*4+4&15;e=a>>>c*4&15;b+=d.toString(16)+e.toString(16)}return b};var e=function(a,b){var c=a<<b|a>>>32-b;return c};var f;var g,h;var i=new Array(80);var j=1732584193;var k=4023233417;var l=2562383102;var m=271733878;var n=3285377520;var o,p,q,r,s;var t;a=b(a);var u=a.length;var v=new Array;for(g=0;g<u-3;g+=4){h=a.charCodeAt(g)<<24|a.charCodeAt(g+1)<<16|a.charCodeAt(g+2)<<8|a.charCodeAt(g+3);v.push(h)}switch(u%4){case 0:g=2147483648;break;case 1:g=a.charCodeAt(u-1)<<24|8388608;break;case 2:g=a.charCodeAt(u-2)<<24|a.charCodeAt(u-1)<<16|32768;break;case 3:g=a.charCodeAt(u-3)<<24|a.charCodeAt(u-2)<<16|a.charCodeAt(u-1)<<8|128;break}v.push(g);while(v.length%16!=14)v.push(0);v.push(u>>>29);v.push(u<<3&4294967295);for(f=0;f<v.length;f+=16){for(g=0;g<16;g++)i[g]=v[f+g];for(g=16;g<=79;g++)i[g]=e(i[g-3]^i[g-8]^i[g-14]^i[g-16],1);o=j;p=k;q=l;r=m;s=n;for(g=0;g<=19;g++){t=e(o,5)+(p&q|~p&r)+s+i[g]+1518500249&4294967295;s=r;r=q;q=e(p,30);p=o;o=t}for(g=20;g<=39;g++){t=e(o,5)+(p^q^r)+s+i[g]+1859775393&4294967295;s=r;r=q;q=e(p,30);p=o;o=t}for(g=40;g<=59;g++){t=e(o,5)+(p&q|p&r|q&r)+s+i[g]+2400959708&4294967295;s=r;r=q;q=e(p,30);p=o;o=t}for(g=60;g<=79;g++){t=e(o,5)+(p^q^r)+s+i[g]+3395469782&4294967295;s=r;r=q;q=e(p,30);p=o;o=t}j=j+o&4294967295;k=k+p&4294967295;l=l+q&4294967295;m=m+r&4294967295;n=n+s&4294967295}var t=c(j)+c(k)+c(l)+c(m)+c(n);return t.toLowerCase()};var _elements={active:0,script:function(a,b){if(Object.prototype.toString.call(a)==="[object Array]")a=_loader.createURL(a);var c=document.createElement("script");c.src=a;document.body.appendChild(c);_elements.active++;var d=function(){if(debug)console.log('"onLoad" removing a script'+c.src);if(!debug)c.parentNode.removeChild(c);if(b)b()};if(c.addEventListener)c.addEventListener("load",d,false);else if(c.attachEvent){var e=c.attachEvent("onload",d);return e}return c},removeScript:function(a){if(!debug){if(debug)console.log("removing script: "+a.getAttribute("src"));a.parentNode.removeChild(a);_elements.active--}return true},removeSelf:function(){var a=document.getElementsByTagName("script");for(var b=0;b<a.length;b++){var c=a[b];if(c.getAttribute("src")){if(c.getAttribute("src").search(/basiin\/init/)!=-1){_elements.removeScript(c)}}}return true}};var _loader={createURL:function(a){var b=_transaction.server.location;for(var c=0;c<a.length;c++){if(a[c]in _transaction.server)b+="/"+_transaction.server[a[c]];else b+="/"+a[c]}return b},hasBandwidth:function(){if(debug)console.log("has Bandwidth "+(_elements.active<_transaction.maxElements&&_elements.active<_transaction.maxTransfers));return _elements.active<_transaction.maxElements&&_elements.active<_transaction.maxTransfers},install:function(a){if(debug)console.log("installing: "+a.tag);a.element=_elements.script(["file",a.file],a.onLoad);a.status="loading"},confirmInstall:function(a){if(debug)console.log("confiming install of: "+a);for(var b=0;b>_loader.files.length;b++){if(_loader.files[b].tag==a){files[b].status="installed";if(_elements.removeScript(files[b].element))_loader.processQueues()}}},files: $jsFiles,transfers:[],getAsset:function(a,b,c){if(_loader[a]==undefined&&_loader[a+"s"])a=a+"s";var d={defined:false,all:false};if(c)for(var e in c){d[e]=c[e]}var f=_loader[a];var g=[];for(var h=0;h<f.length;h++){var i=f[h];var j=true;for(var k in b){j=j&&(d.defined==false&&i[k]==undefined||i[k]==b[k])}if(d.all&&j)g.push(i);else if(j)return i}if(g.length==0)return false;else return g},getFile:function(a,b){return _loader.getAsset("file",a,b)},getTransfer:function(a,b){return _loader.getAsset("transfer",a,b)},processQueues:function(){var a=false;var b=false;while(_loader.hasBandwidth()&&(a=_loader.getFile({status:"queued"}))){_loader.install(a)}while(_loader.hasBandwidth()&&(b=_loader.getTransfer({status:"queued"}))){b.start();if(debug)console.log("transfering: "+b.tag+"("+b.file+")")}},calculatePieceLength:function(a){return 1e3-a.length},Transfer:function(a){if(a.onComplete==undefined)a.onComplete=False;var b=new RegExp(".{1,"+a.pieceL+"}","g");a.pieces=a.data.match(b);a.pieceStatus=function(a){var b=new Array(a);var c=a;while(c--){b[c]=false}return b}(a.pieces.length);var c={1:"queued",2:"transfering",3:"complete"};var d=1;return{tag:function(){return a.tag},reTag:function(){this.tag=_hash(Math.random());return a.tag},data:function(){return a.data},pieces:function(){return a.pieces},progress:function(){var b=0;var c;var d=c=a.piecesTotal;while(c--){if(a.pieceStatus[c]==true)b++}return b/d},onComplete:function(){return a.onComplete},status:function(){return c[d]},pieceComplete:function(b,c){a.pieceStatus[b]=true;if(c){};},start:function(){if(d==1){d=2;return true}return false},pause:function(){if(d==2){d=1;return true}return false},erase:function(){return undefined}}}};return{transaction:function(){return _transaction},hash:function(){return _hash()},loader:{files:function(){return _loader.files},transfer:function(tr){tr.pieceL=calculatePieceLength(tr.url);var transfer=new Transfer(tr,basiin);while(transfers.hasOwnProperty(transfer.tag)){transfer.reTag()}eval("this.transfers."+transfer.tag()+"= "+transfer)},install:function(a,b){_install(a,b)},confirmInstall:function(a){return _loader.confirmInstall(a)},completed:function(a,b,c){if(!c)c=true;if(true){if(true){};}}},tell:function(a,b,c){if(!b)b=__transaction.tell;if(!c)c=this._hash(Math.random());var d={};d.data=a;d.url=b;d.tag=c;this.sender.startTransfer(d)},install:function(a,b){this.loader.install({tag:a,file:b})},confirmInstall:function(a){return this.loader.confirmInstall(a)},init:function(){if(!_initialized){_initialized=true;if(debug)console.log("basiin transaction "+_transaction.id+" initializing,");eval("window."+_transaction.id+" = this");_loader.processQueues();_elements.removeSelf();if(debug)console.log("basiin transaction "+_transaction.id+" init completed,")}else{if(debug)console.log("basiin transaction "+_transaction.id+" already initialized,");return false}return this}}})( $debug).init()